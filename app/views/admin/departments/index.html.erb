<!-- DataTales Example -->
<form action="departments" class="d-none d-sm-inline-block form-inline mr-auto ml-md-3 my-2 my-md-0 mw-100 navbar-search w-25" method="get">
  <div class="input-group">
    <input name="where[full_name_cont]" type="text" class="form-control bg-light border-0 small mr-4" placeholder="Name" aria-label="Search" aria-describedby="basic-addon2">
    <%= select_tag "where[status_eq]",  options_for_select(status_options, params[:where].present?  ? params[:where]["status_eq"] : ""), class: "form-control bg-light border-0 small mr-4", onchange: "this.form.submit();" %>
    <div class="input-group-append">
      <button class="btn btn-primary" type="submit">
        <i class="fas fa-search fa-sm"></i>
      </button>
    </div>
  </div>
</form>
<table class="table table-hover mt-4" id="dataTable" width="100%" cellspacing="0">
    <thead class="text-center">
        <tr>
            <th >Id</th>
            <th>Name</th>
            <th>Leader</th>
            <th>Sub Leader</th>
            <th class="w-25">Member</th>
            <th>Start date</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody class="text-center">
      <% @departments.each.with_index(1) do |department, index| %>
        <tr>
          <td><%= (department.id > 9 ? "0000" : "00000") + department.id.to_s %></td>
          <td><%= department.name %></td>
          <td><%= full_name(department.user_departments.role_leader&.first&.user) %></td>
          <td><%= full_name(department.user_departments.role_subleader&.first&.user) %></td>
          <td>
            <% user_full_names = department.user_departments.includes(:user).role_member.map { |ud| ud.user.full_name + " - " +  ud.user.user_code } %>
            <% user_full_names.first(2).each do |ufn| %>
              <%= ufn %></br>
            <% end %>
            <div class="collapse" id="collapseMember<%= department.id %>">
              <% user_full_names[2..].each do |ufn| %>
                <%= ufn %></br>
              <% end %>
            </div>
              <a data-toggle="collapse" href="#collapseMember<%= department.id %>" role="button" aria-expanded="false" aria-controls="collapseMember<%= department.id %>" onClick="moreInfo(this)">See more</a>
          </td>
          </td>
          <td><%=  department.created_at&.strftime("%F") %></td>
          <td>
            <div class="text-center">
              <a href="departments/<%= department.id %>" class="actionLink mr-3" title="Edit"><i class="fa-regular fa-pen-to-square text-success"></i></a>
              <a href="departments/<%= department.id %>" class="actionLink" title="Remove" data-confirm="Are you want to delete this department?" data-method="delete">
                <i class="fa-solid fa-trash text-danger"></i>
              </a>
            </div>
          </td>
        </tr>
      <% end %>
    </tbody>
</table>
<%= will_paginate @departments %>
<%= render 'partials/blank_table', object: @departments %>

<script>
  function moreInfo(element) {
    if (element.getAttribute('aria-expanded').toLowerCase() === 'true'){
      element.innerHTML = "See more"
    } else {
      element.innerHTML = "See less"
    }
  }
</script>