<div id='calendar' style=""></div>
<script>
	$( document ).ready(function() {
		var token = localStorage.getItem('token');
		var calendarEl = document.getElementById('calendar');

		var calendar = new FullCalendar.Calendar(calendarEl, {
			initialView: 'dayGridMonth',
			selectable: true,
			height: 960,
			dayMaxEventRows: 4,
			displayEventTime: false,
			eventSources: [
				{ 
					events: function(fetchInfo, successCallback, failureCallback) {
						$.ajax({
								url: '<%=ENV.fetch("BE_HOST") %>/api/v1/time_sheets',
								dataType: 'json',
								headers: {
									token: token
								},
								data: {
									where: {
										start_at_gteq: fetchInfo.startStr,
										end_at_lteq: fetchInfo.endStr
									},
									user_id: <%= current_user.id %>
								},
								success: function(doc) {
									successCallback(doc.data);
								}
						});
					}
				},
				{
					events: function(fetchInfo, successCallback, failureCallback) {
						$.ajax({
								url: '<%= ENV.fetch("BE_HOST") %>/api/v1/holidays',
								dataType: 'json',
								headers: {
									token: token
								},
								data: {
									where: {
										start_date_gteq: fetchInfo.startStr,
										end_date_lteq: fetchInfo.endStr
									}
								},
								success: function(doc) {
									successCallback(doc.data);
								}
						});
					}
				},
				{
					events: function(fetchInfo, successCallback, failureCallback) {
						$.ajax({
								url: '<%= ENV.fetch("BE_HOST") %>/api/v1/leave_requests',
								dataType: 'json',
									headers: {
									token: token
								},
								data: {
									where: {
										start_date_gteq: fetchInfo.startStr,
										end_date_lteq: fetchInfo.endStr
									},
									user_id: <%= current_user.id %>
								},
								success: function(doc) {
									successCallback(doc.data);
								}
						});
					}
				}
			],
			eventClick: function(info) {
				alert('Event: ' + info.event.title);

				calendar.unselect()
			},
			eventMouseEnter: function(info){
				info.el.style.cursor = 'pointer';
				info.el.style.opacity = "0.8"
			},
			eventMouseLeave: function(info){
				info.el.style.cursor = '';
				info.el.style.opacity = "1"
			},
			select: function(info) {
				alert('Event: ' + info.startStr);

				calendar.unselect()
			},
			eventDidMount: function(info) {
				info.el.style.margin = "1px";
				info.el.style.padding = "1px";
			}
		});

		calendar.render();
	});


</script>